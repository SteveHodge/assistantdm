<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
	<link rel="stylesheet" type="text/css" href="/assistantdm/static/character.css"/>
	<title>{{name}}</title>
	<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
	<script src="/assistantdm/static/updater.js"></script>
	<script async src="/assistantdm/static/dialog_box.js"></script>
	<script>
// TODO inline script means we can't defer jquery

var xsl;

function displayXML(xml) {
	var div = document.getElementById("content");
	// code for IE
	if (window.ActiveXObject) {
		div.innerHTML=xml.transformNode(xsl);
	}
	// code for Mozilla, Firefox, Opera, etc.
	else if (document.implementation && document.implementation.createDocument) {
		xsltProcessor=new XSLTProcessor();
		xsltProcessor.importStylesheet(xsl);
		resultDocument = xsltProcessor.transformToFragment(xml,document);
		while (div.hasChildNodes()) div.removeChild(div.firstChild);
		div.appendChild(resultDocument);
	}
}

updater.addListener('{{name}}.xml', function() {
	$.get('/assistantdm/{{name}}/xml?unique='+(new Date()).valueOf(), displayXML);
});

$(document).ready(function () {
	$.get('/assistantdm/static/CharacterTemplate.xsl', function(data) {
		xsl = data;
		$.get('/assistantdm/{{name}}/xml?unique='+(new Date()).valueOf(), displayXML);
	});

	updater.onError = function(state) {
		if (state === EventSource.CLOSED) {
			alert('Lost connection to the server\nNo more updates will occur');
		} else if (state === EventSource.CONNECTING) {
		} else {
			alert('Lost connection to server, unknown error\nNo more updates will occur');
		}
	}

	updater.openConnection();
});
	</script>
</head>

<body style="font-size:62.5%;">
	<div id="content"></div>
</body>
</html>
