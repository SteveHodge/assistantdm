<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<!--<meta name="viewport" content="width=480">-->
	<link rel="stylesheet" type="text/css" href="http://static.stevehodge.net/spelllist.css">
	<link rel="stylesheet" type="text/css" href="http://static.stevehodge.net/character.css"/>
	<title>{{name}}</title>
	<script src="//code.jquery.com/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="http://static.stevehodge.net/dialog_box.js" async></script>
	<script src="/assistantdm/static/updater.js"></script>
	<script type="text/javascript" src="http://static.stevehodge.net/spelllist.js" defer></script>
	<script type="text/javascript">
var xsl;

function displayXML(xml) {
	var div = document.getElementById("tab_sheet");
	// code for IE
	if (window.ActiveXObject) {
		div.innerHTML=xml.transformNode(xsl);
	}
	// code for Mozilla, Firefox, Opera, etc.
	else if (document.implementation && document.implementation.createDocument) {
		xsltProcessor=new XSLTProcessor();
		xsltProcessor.importStylesheet(xsl);
		resultDocument = xsltProcessor.transformToFragment(xml,document);
		while (div.hasChildNodes()) div.removeChild(div.firstChild);
		div.appendChild(resultDocument);
	}
}

updater.addListener('{{name}}.xml', function() {
	$.get('/assistantdm/{{name}}/xml?unique='+(new Date()).valueOf(), displayXML);
});

$(document).ready(function () {
	WRAPPER = 'tab_sheet';	// set element id for the dialog box to use

	$.get('/assistantdm/static/CharacterTemplate.xsl', function(data) {
		xsl = data;
		$.get('/assistantdm/{{name}}/xml?unique='+(new Date()).valueOf(), displayXML);
	});

	updater.onError = function(state) {
		if (state === EventSource.CLOSED) {
			alert('Lost connection to the server\nNo more updates will occur');
		} else if (state === EventSource.CONNECTING) {
		} else {
			alert('Lost connection to server, unknown error\nNo more updates will occur');
		}
	}

	updater.openConnection();
});
	</script>
</head>
<body>
	<div id="tabs"></div>

	<div id="tab_content">
		<section id="tab_sheet" style="font-size:62.5%;" class="tab" name="Sheet 1"></section>
		{{#content}}
		<section id="tab_cast" style="display:none;" class="tab" name="Cast" saveurl="/spells">
			<div>
				<h3>Memorised</h3>
				<div id="spellList" class="scrollable" button="btnSpells" style="width:300px">
					{{#spells}}
					<div class="selectable">{{{html}}}</div>
					{{/spells}}
				</div>
				<br><input type="button" id="btnSpells" value="Cast" onclick="castSpell()"/>
				<input type="button" value="Rest" onclick="rest()"/>
			</div>
		</section>
		{{/content}}
		{{{content}}}
	</div>
</body>
</body>
</html>
